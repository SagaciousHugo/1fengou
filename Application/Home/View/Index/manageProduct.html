<extend name="Base/common"/>

<block name="defineScript">
    <script type="text/javascript">
        $(function(){
            var table = $('#productInfo'),
                products = table.find('[name=product]'),
                selectAll = $('#selectAll');
                selectAll2 = $('#selectAll2');
            selectAll.click(function(){
                products.prop('checked',this.checked);
                selectAll2.prop('checked',this.checked);
            });
            selectAll2.click(function(){
                products.prop('checked',this.checked);
                selectAll.prop('checked',this.checked);
            });
            products.click(function(){
                var isAllChecked=products.map(function(){return this.checked;}).get().reduce((x,y)=>x&&y);
                if(isAllChecked||selectAll.is(":checked")||selectAll2.is(":checked")){
                    selectAll.prop('checked',isAllChecked);
                    selectAll2.prop('checked',isAllChecked);
                }
            });
        });

        function deleteProduct(productId){
            $.ajax({
                type: "GET",
                url: "http://localhost/1fengou/index.php/home/Index/deleteProduct/id/" + productId,
                dataType:'json',
                success: function ($message) {
                    if($message == 'deleteSuccess'){
                      $('#deleteConfirm').modal('toggle');
                        $(".modal-backdrop").remove();
                        $(".jvectormap-label").remove();
                        $.ajax({
                            type: "GET",
                            url: "http://localhost/1fengou/index.php/home/Index/index/type/manage",
                            success:function(data){
                                $("#contentDiv").html(data);
                                $('#opSuccess').modal('show');
                            }
                        })
/*                        $('#opSuccess').modal('show');
                        window.location.reload();*/
                    }
                }
            });
        };

        function deleteBatch(){
            var table = $('#productInfo'),
                products = table.find('[name=product]'),
                arr = [],
                re = 0;
            var selectedList = products.map(function(){
                if(this.checked){
                    arr.push(this.value);
                    re = re +1;
                }
                return arr;
            }).get().slice(0,re);

            $.ajax({
                type: "GET",
                url: ,
                dataType:'json',
                success: function ($message) {
                    if($message == 'deleteSuccess'){
                        $('#deleteConfirm').modal('toggle');
                        $(".modal-backdrop").remove();
                        $(".jvectormap-label").remove();
                        $.ajax({
                            type: "GET",
                            url: "http://localhost/1fengou/index.php/home/Index/index/type/manage",
                            success:function(data){
                                $("#contentDiv").html(data);
                                $('#opSuccess').modal('show');
                            }
                        })

                    }
                }
            });

        };
    </script>

</block>

<block name="mainContent">
    <div class="content-wrapper">
        <section class="content-header">
            <h1>
                管理商品
                <small>商品详情</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-gears"></i> 管理商品</a></li>
                <li class="active">商品详情</li>
            </ol>
        </section>

        <section class="content">
            <div class="row">
                <section class="col-lg-12 col-xs-12">
                    <div>
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">商品详情列表</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="dataTables_wrapper form-inline dt-bootstrap">
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="dataTables_length" id="example1_length">
                                                <label>每页显示
                                                    <select name="example1_length" aria-controls="example1" class="form-control input-sm">
                                                        <option value="10">10</option>
                                                        <option value="25">25</option>
                                                        <option value="50">50</option>
                                                        <option value="100">100</option>
                                                    </select> 条数据
                                                </label>
                                            </div>
                                        </div>

                                        <div class="col-lg-4">
                                            <div id="example1_filter" class="dataTables_filter">
                                                <label>查询商品名称:
                                                    <input type="search" class="form-control input-sm" placeholder="" aria-controls="example1">
                                                </label>
                                            </div>
                                        </div>

                                        <div class="col-lg-4">
                                            <a href="javascript:deleteBatch()" class="btn btn-danger btn-lg btn-sm active" role="button">批量删除</a>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <table id="productInfo" class="table table-bordered table-striped table-hover">
                                                <thead>
                                                <tr>
                                                    <th>
                                                        <input type="checkbox" id="selectAll"/>全选
                                                    </th>
                                                    <th>
                                                        商品Id
                                                    </th>
                                                    <th>
                                                        商品名称
                                                    </th>
                                                    <th>
                                                        商品价格(￥)
                                                    </th>
                                                    <th>
                                                        商品简介
                                                    </th>
                                                    <th>
                                                        已售数量
                                                    </th>
                                                    <th>
                                                        商品缩略图
                                                    </th>
                                                    <th>
                                                        操作
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <volist name="productList" id="vo">
                                                    <tr>
                                                        <td>
                                                            <input type="checkbox" name="product" value={$vo['id']} />
                                                        </td>
                                                        <td align="center" name="productId" value={$vo['id']}>
                                                            {$vo['id']}
                                                        </td>
                                                        <td align="center">
                                                            {$vo['name']}
                                                        </td>
                                                        <td align="center">
                                                            {$vo['price']}
                                                        </td>
                                                        <td align="center">
                                                            {$vo['introduce']}
                                                        </td>
                                                        <td align="center">
                                                            {$vo['sales']}
                                                        </td>
                                                        <td align="center">
                                                            <img width="150" height="150" src="__PUBLIC__/{$vo['thumbnail']}" alt="商品缩略图"/>
                                                        </td>
                                                        <td align="center">
                                                            <a class=".btn.btn-app" href="http://localhost/1fengou/index.php/home/Index/editProduct/id/{$vo['id']}">
                                                                <i class="fa fa-edit"></i> 修改
                                                            </a>
                                                            <a class=".btn.btn-app" href="#" data-toggle="modal" data-target="#deleteConfirm">
                                                                <i class="fa fa-remove"></i> 删除
                                                            </a>
                                                        </td>
                                                    </tr>


                                                    <!-- （Modal）用于删除二次确认 -->
                                                    <div class="modal fade" id="deleteConfirm" tabindex="-1" role="dialog"
                                                         aria-labelledby="myModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <button type="button" class="close"
                                                                            data-dismiss="modal" aria-hidden="true">
                                                                        &times;
                                                                    </button>
                                                                    <h4 class="modal-title" id="myModalLabel">
                                                                        删除提示
                                                                    </h4>
                                                                </div>
                                                                <div class="modal-body">
                                                                    确认删除该商品？
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-primary" onclick="javascript:deleteProduct({$vo['id']})">
                                                                        确认
                                                                    </button>
                                                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                                                        取消
                                                                    </button>
                                                                </div>
                                                            </div><!-- /.modal-content -->
                                                        </div><!-- /.modal -->
                                                    </div>
                                                </volist>
                                                </tbody>
                                                <tfoot>
                                                <tr>
                                                    <th>
                                                        <input type="checkbox" id="selectAll2"/>全选
                                                    </th>
                                                    <th>商品Id</th>
                                                    <th>商品名称</th>
                                                    <th>商品价格(￥)</th>
                                                    <th>商品简介</th>
                                                    <th>已售数量</th>
                                                    <th>商品缩略图</th>

                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-5">
                                            <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                                                当前显示至条数据，共条数据
                                            </div>
                                        </div>


                                        <div class="col-lg-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                                                <ul class="pagination">
                                                    <li class="paginate_button previous disabled" id="example1_previous">
                                                        <a href="#" aria-controls="example1" data-dt-idx="0" tabindex="0">上一页</a>
                                                    </li>
                                                    <li class="paginate_button active">
                                                        <a href="#" aria-controls="example1" data-dt-idx="1" tabindex="0">1</a>
                                                    </li>
                                                    <li class="paginate_button ">
                                                        <a href="#" aria-controls="example1" data-dt-idx="2" tabindex="0">2</a>
                                                    </li>
                                                    <li class="paginate_button ">
                                                        <a href="#" aria-controls="example1" data-dt-idx="3" tabindex="0">3</a>
                                                    </li>
                                                    <li class="paginate_button ">
                                                        <a href="#" aria-controls="example1" data-dt-idx="4" tabindex="0">4</a>
                                                    </li>
                                                    <li class="paginate_button ">
                                                        <a href="#" aria-controls="example1" data-dt-idx="5" tabindex="0">5</a>
                                                    </li>
                                                    <li class="paginate_button ">
                                                        <a href="#" aria-controls="example1" data-dt-idx="6" tabindex="0">6</a>
                                                    </li>
                                                    <li class="paginate_button next" id="example1_next">
                                                        <a href="#" aria-controls="example1" data-dt-idx="7" tabindex="0">下一页</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                </section>
            </div>

            <!-- （Modal）用于操作成功提示 -->
            <div class="modal fade" id="opSuccess" tabindex="-1" role="dialog"
                 aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close"
                                    data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="todo">
                                操作提示
                            </h4>
                        </div>
                        <div class="modal-body">
                            操作成功!
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">
                                确认
                            </button>

                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

</block>